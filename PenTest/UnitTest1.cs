using NUnit.Framework;
using Unit_test;
using System.Reflection;
using System;
using System.Diagnostics;
using System.IO;
using System.Collections.Generic;

namespace PenTest
{
    public class Tests
    {
        private static IEnumerable<TestCaseData> ParametersForPositiveWrite()
        {
            yield return new TestCaseData(new Pen(1), "w");
            yield return new TestCaseData(new Pen(Int32.MaxValue), "word");
        }

        private static IEnumerable<TestCaseData> ParametersForNegativeWrite()
        {
            yield return new TestCaseData(new Pen(1), "word");
            yield return new TestCaseData(new Pen(Int32.MaxValue), null);
        }


        [TestCase(1)]
        [TestCase(Int32.MaxValue)]
        public void ConstructorWithOneArgumentTest_Positiv(int inkContainerValue)
        {
            Pen pen = new Pen(inkContainerValue);
            FieldInfo fieldInfo = typeof(Pen).GetField("inkContainerValue", BindingFlags.Instance | BindingFlags.NonPublic);
            Assert.AreEqual(inkContainerValue, (int)fieldInfo.GetValue(pen));
        }

        [TestCase(Int32.MinValue)]
        [TestCase(0)]
        public void ConstructorWithOneArgumentTest_Negative(int inkContainerValue)
        {
            Pen pen = new Pen(inkContainerValue);
            FieldInfo fieldInfo = typeof(Pen).GetField("inkContainerValue", BindingFlags.Instance | BindingFlags.NonPublic);
            Assert.AreNotEqual(inkContainerValue, (int)fieldInfo.GetValue(pen));
        }

        [TestCase(1)]
        [TestCase(Double.MaxValue)]
        public void ConstructorWithTwoArgumentTest_Positiv(double sizeLetter)
        {
            Pen pen = new Pen(1, sizeLetter);
            FieldInfo sizeLetterInfo = typeof(Pen).GetField("sizeLetter", BindingFlags.Instance | BindingFlags.NonPublic);
            Assert.AreEqual(sizeLetter, sizeLetterInfo.GetValue(pen));
        }

        [TestCase(Double.MinValue)]
        [TestCase(0)]
        public void ConstructorWithTwoArgumentTest_Negative(double sizeLetter)
        {
            Pen pen = new Pen(1, sizeLetter);
            FieldInfo sizeLetterInfo = typeof(Pen).GetField("sizeLetter", BindingFlags.Instance | BindingFlags.NonPublic);
            Assert.AreNotEqual(sizeLetter, sizeLetterInfo.GetValue(pen));
        }

        [TestCase("RED")]
        [TestCase("WHITE")]
        [TestCase("GREEN")]
        [Test]
        public void ConstructorWithThreeArgumentTest_Positiv(string color)
        {
            Pen pen = new Pen(1, 1.0, color);
            FieldInfo colorInfo = typeof(Pen).GetField("color", BindingFlags.Instance | BindingFlags.NonPublic);
            Assert.AreEqual(color, colorInfo.GetValue(pen));
        }

        [TestCase("")]
        [TestCase(null)]
        [Test]
        public void ConstructorWithThreeArgumentTest_Negative(string color)
        {
            Pen pen = new Pen(1, 1.0, color);
            FieldInfo colorInfo = typeof(Pen).GetField("color", BindingFlags.Instance | BindingFlags.NonPublic);
            Assert.AreNotEqual(color, colorInfo.GetValue(pen));
        }


        [Test, TestCaseSource("ParametersForPositiveWrite")]
        public void TestPenWrite_shouldWriteAndReturnWord_Positiv(Pen pen, string word)
        {
            Assert.AreEqual(word, pen.write(word));
        }

        [Test, TestCaseSource("ParametersForNegativeWrite")]
        public void TestPenWrite_shouldWriteAndReturnWord_Negative(Pen pen, string word)
        {
            Assert.AreNotEqual(word, pen.write(word));
        }

        [TestCase("RED")]
        [TestCase("WHITE")]
        [TestCase("GREEN")]
        public void TestPenGetColor_shouldReturnFiledColor(String color)
        {
            Pen pen = new Pen(1, 2, color);
            Assert.AreEqual(color, pen.getColor());
        }

        [TestCase(1)]
        [TestCase(2)]
        [TestCase(Int32.MaxValue)]
        public void TestPenIsWork_shouldCheckIfPenContainsInk_Positiv(int inkValueParameter)
        {
            Pen pen = new Pen(inkValueParameter);
            FieldInfo inkContainerValueInfo = typeof(Pen).GetField("inkContainerValue", BindingFlags.Instance | BindingFlags.NonPublic);
            int inkValue = (int)inkContainerValueInfo.GetValue(pen);
            Assert.IsTrue(pen.isWork());
        }

        [TestCase(Int32.MinValue)]
        [TestCase(-1)]
        [TestCase(0)]
        public void TestPenIsWork_shouldCheckIfPenContainsInk_Negativ(int inkValueParameter)
        {
            Pen pen = new Pen(inkValueParameter);
            FieldInfo inkContainerValueInfo = typeof(Pen).GetField("inkContainerValue", BindingFlags.Instance | BindingFlags.NonPublic);
            int inkValue = (int)inkContainerValueInfo.GetValue(pen);
            Assert.IsFalse(pen.isWork());
        }

        [Test]
        public void doSomethingElse()
        {
            Pen pen = new Pen(1);

            TextWriterTraceListener listener = new TextWriterTraceListener(@".\DebugOutput.txt");
            Trace.Listeners.Add(listener);
            pen.doSomethingElse();
            Trace.Flush();
            listener.Close();

            StreamReader file = new StreamReader(@".\DebugOutput.txt", System.Text.Encoding.Default);
            string line = file.ReadLine();
            file.Close();

            FieldInfo colorValueInfo = typeof(Pen).GetField("color", BindingFlags.Instance | BindingFlags.NonPublic);
            string value = (string)colorValueInfo.GetValue(pen);

            Assert.AreEqual(pen.getColor(), line);
        }
    }
}