using NUnit.Framework;
using Unit_test;
using System.Reflection;
using System;
using System.Diagnostics;
using System.IO;
using System.Collections.Generic;

namespace PenTest
{
    public class Tests
    {
        private static IEnumerable<TestCaseData> ParametersForPositiveWrite()
        {
            yield return new TestCaseData(new Pen(1), "w");
            yield return new TestCaseData(new Pen(Int32.MaxValue), "word");
        }

        private static IEnumerable<TestCaseData> ParametersForNegativeWrite()
        {
            yield return new TestCaseData(new Pen(1), "word");
            yield return new TestCaseData(new Pen(Int32.MaxValue), null);
        }

        [TestCase(1)]
        [TestCase(Int32.MaxValue)]
        public void ConstructorWithOneArgumentTestPositiv(int inkContainerValue)
        {
            Pen pen = new Pen(inkContainerValue);
            FieldInfo fieldInfo = typeof(Pen).GetField("inkContainerValue", BindingFlags.Instance | BindingFlags.NonPublic);
            Assert.AreEqual(inkContainerValue, (int)fieldInfo.GetValue(pen), "Invalid object (field <inkContainerValue> is incorrectly initialized)");
        }

        [TestCase(Int32.MinValue)]
        [TestCase(0)]
        public void ConstructorWithOneArgumentTestNegative(int inkContainerValue)
        {
            Pen pen = new Pen(inkContainerValue);
            FieldInfo fieldInfo = typeof(Pen).GetField("inkContainerValue", BindingFlags.Instance | BindingFlags.NonPublic);
            Assert.AreNotEqual(inkContainerValue, (int)fieldInfo.GetValue(pen), "Invalid object (field <inkContainerValue> is incorrectly initialized)");
        }

        [TestCase(1)]
        [TestCase(Double.MaxValue)]
        public void ConstructorWithTwoArgumentTestPositiv(double sizeLetter)
        {
            Pen pen = new Pen(1, sizeLetter);
            FieldInfo sizeLetterInfo = typeof(Pen).GetField("sizeLetter", BindingFlags.Instance | BindingFlags.NonPublic);
            Assert.AreEqual(sizeLetter, sizeLetterInfo.GetValue(pen), "Invalid object (field <sizeLetter> is incorrectly initialized)");
        }

        [TestCase(Double.MinValue)]
        [TestCase(0)]
        public void ConstructorWithTwoArgumentTestNegative(double sizeLetter)
        {
            Pen pen = new Pen(1, sizeLetter);
            FieldInfo sizeLetterInfo = typeof(Pen).GetField("sizeLetter", BindingFlags.Instance | BindingFlags.NonPublic);
            Assert.AreNotEqual(sizeLetter, sizeLetterInfo.GetValue(pen), "Invalid object (field <sizeLetter> is incorrectly initialized)");
        }

        [TestCase("RED")]
        [TestCase("WHITE")]
        [TestCase("GREEN")]
        [Test]
        public void ConstructorWithThreeArgumentTestPositiv(string color)
        {
            Pen pen = new Pen(1, 1.0, color);
            FieldInfo colorInfo = typeof(Pen).GetField("color", BindingFlags.Instance | BindingFlags.NonPublic);
            Assert.AreEqual(color, colorInfo.GetValue(pen), "Invalid object (field <color> is incorrectly initialized)");
        }

        [TestCase("")]
        [TestCase(null)]
        [Test]
        public void ConstructorWithThreeArgumentTestNegative(string color)
        {
            Pen pen = new Pen(1, 1.0, color);
            FieldInfo colorInfo = typeof(Pen).GetField("color", BindingFlags.Instance | BindingFlags.NonPublic);
            Assert.AreNotEqual(color, colorInfo.GetValue(pen), "Invalid object (field <color> is incorrectly initialized)");
        }


        [Test, TestCaseSource("ParametersForPositiveWrite")]
        public void TestPenWrite_shouldWriteAndReturnWordPositiv(Pen pen, string word)
        {
            Assert.AreEqual(word, pen.write(word), "Method doesn't return correct word.");
        }

        [Test, TestCaseSource("ParametersForNegativeWrite")]
        public void TestPenWrite_shouldWriteAndReturnWordNegative(Pen pen, string word)
        {
            Assert.AreNotEqual(word, pen.write(word), "Method doesn't return correct word.");
        }

        [TestCase("RED")]
        [TestCase("WHITE")]
        [TestCase("GREEN")]
        public void TestPenGetColor_shouldReturnFiledColor(String color)
        {
            Pen pen = new Pen(1, 2, color);
            Assert.AreEqual(color, pen.getColor(), "Method doesn't return right <color> value.");
        }

        [TestCase(1)]
        [TestCase(2)]
        [TestCase(Int32.MaxValue)]
        public void TestPenIsWork_shouldCheckIfPenContainsInkPositiv(int inkValueParameter)
        {
            Pen pen = new Pen(inkValueParameter);
            FieldInfo inkContainerValueInfo = typeof(Pen).GetField("inkContainerValue", BindingFlags.Instance | BindingFlags.NonPublic);
            int inkValue = (int)inkContainerValueInfo.GetValue(pen);
            Assert.IsTrue(pen.isWork(), "Method return false, but inkValueParameter is positiv.");
        }

        [TestCase(Int32.MinValue)]
        [TestCase(-1)]
        [TestCase(0)]
        public void TestPenIsWork_shouldCheckIfPenContainsInkNegativ(int inkValueParameter)
        {
            Pen pen = new Pen(inkValueParameter);
            FieldInfo inkContainerValueInfo = typeof(Pen).GetField("inkContainerValue", BindingFlags.Instance | BindingFlags.NonPublic);
            int inkValue = (int)inkContainerValueInfo.GetValue(pen);
            Assert.IsFalse(pen.isWork(), "Method return true, but inkValueParameter is negative.");
        }

        [Test]
        public void doSomethingElse()
        {
            Pen pen = new Pen(1);

            TextWriterTraceListener listener = new TextWriterTraceListener(@".\DebugOutput.txt");
            Trace.Listeners.Add(listener);
            pen.doSomethingElse();
            Trace.Flush();
            listener.Close();

            StreamReader file = new StreamReader(@".\DebugOutput.txt", System.Text.Encoding.Default);
            string line = file.ReadLine();
            file.Close();

            FieldInfo colorValueInfo = typeof(Pen).GetField("color", BindingFlags.Instance | BindingFlags.NonPublic);
            string value = (string)colorValueInfo.GetValue(pen);

            Assert.AreEqual(pen.getColor(), line, "Debug output doesn't match with <color> value.");
        }
    }
}